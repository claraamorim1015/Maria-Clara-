const playBtn = document.getElementById('play');
const gameArea = document.getElementById('gameArea');
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreText = document.getElementById('score');

let car, obstacles, score, gameActive, animationId;

function startGame() {
    car = { x: 170, y: 500, width: 60, height: 100, color: 'red' };
    obstacles = [];
    score = 0;
    gameActive = true;
    gameArea.style.display = 'block';
    playBtn.style.display = 'none';
    scoreText.textContent = '';
    animate();
}

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Desenha o carro
    ctx.fillStyle = car.color;
    ctx.fillRect(car.x, car.y, car.width, car.height);

    // Obstáculos
    if (Math.random() < 0.03) {
        const obsX = Math.random() * (canvas.width - 60);
        obstacles.push({ x: obsX, y: -100, width: 60, height: 100, color: 'yellow' });
    }
    for (let i = 0; i < obstacles.length; i++) {
        const obs = obstacles[i];
        obs.y += 5;
        ctx.fillStyle = obs.color;
        ctx.fillRect(obs.x, obs.y, obs.width, obs.height);

        // Colisão
        if (
            car.x < obs.x + obs.width &&
            car.x + car.width > obs.x &&
            car.y < obs.y + obs.height &&
            car.y + car.height > obs.y
        ) {
            endGame();
            return;
        }
    }
    // Remove obstáculos fora da tela
    obstacles = obstacles.filter(obs => obs.y < canvas.height);

    // Score
    score++;
    scoreText.textContent = "Pontuação: " + score;

    if (gameActive) {
        animationId = requestAnimationFrame(animate);
    }
}

// Controle do carro
document.addEventListener('keydown', function(e) {
    if (!gameActive) return;
    if (e.key === 'ArrowLeft' && car.x > 0) car.x -= 20;
    if (e.key === 'ArrowRight' && car.x < canvas.width - car.width) car.x += 20;
});

function endGame() {
    gameActive = false;
    cancelAnimationFrame(animationId);
    scoreText.textContent = `Game Over! Sua pontuação: ${score}`;
    playBtn.textContent = "Jogar Novamente";
    playBtn.style.display = 'inline-block';
    gameArea.style.display = 'none';
}

playBtn.addEventListener('click', startGame);
